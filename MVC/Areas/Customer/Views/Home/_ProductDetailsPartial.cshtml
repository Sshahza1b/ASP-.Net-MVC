@model MVC.Models.Product

<div class="row">
    <div class="col-md-5 text-center">
        <img src="@Model.ImageUrl" class="img-fluid rounded shadow-sm" alt="@Model.Title" />
    </div>
    <div class="col-md-7">
        <h3 class="fw-bold text-primary">@Model.Title</h3>
        <p class="text-muted mb-1">Category: <span class="badge bg-info">@Model.Category?.Name</span></p>
        <p class="text-muted">Author: <strong>@Model.Author</strong></p>

        <div class="my-3 p-3 bg-light rounded" style="max-height: 120px; overflow-y: auto;">
            @Html.Raw(Model.Description)
        </div>

        <div class="p-3 mb-3 border rounded bg-white shadow-sm">
            <div class="row align-items-center">
                <div class="col-6">
                    <small class="text-muted d-block">Your Total Price</small>
                    <h4 class="text-danger fw-bold mb-0">
                        $ <span id="totalPriceDisplay">@Model.Price100.ToString("0.00")</span>
                    </h4>
                </div>
                <div class="col-6 text-end border-start">
                    <small class="text-muted d-block">Actual List Price</small>
                    <span class="text-decoration-line-through text-muted fw-bold">
                        $ <span id="totalListPriceDisplay">@Model.ListPrice.ToString("0.00")</span>
                    </span>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <form method="post" asp-action="Details">
                <input hidden name="ProductId" value="@Model.Id" />

                <div class="row g-2">
                    <div class="col-4">
                        <label class="small text-muted fw-bold">Quantity</label>
                        <input type="number" id="txtQuantity" name="Count" value="1"
                               class="form-control border-primary shadow-sm" min="1" />
                    </div>
                    <div class="col-8 align-self-end">
                        @if (!User.Identity.IsAuthenticated)
                        {
                            <button type="button" onclick="showLoginAlert()" class="btn btn-primary form-control">
                                Add to Cart
                            </button>
                        }
                        else
                        {
                            <button type="submit" class="btn btn-primary form-control">
                                Add to Cart
                            </button>
                        }

                        <script>
                                                      function showLoginAlert() {
                                Swal.fire({
                                    title: 'Please Login',
                                    text: "You need to login to add items to cart",
                                    icon: 'info',
                                    showCancelButton: true,
                                    confirmButtonText: 'Login Now',
                                    cancelButtonText: 'Cancel',
                                    confirmButtonColor: '#0d6efd' // Bootstrap primary color
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        // 1. Pehle SweetAlert ko close karein
                                        Swal.close();

                                        // 2. Layout mein jo modal hai usay trigger karein
                                        // #authModal wahi ID hai jo aapke _Layout mein modal ki hai
                                        var myModal = new bootstrap.Modal(document.getElementById('authModal'));
                                        myModal.show();
                                    }
                                });
                            }
                        </script>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        // Dono prices ko variables mein parse kar liya
        var unitPrice = parseFloat("@Model.Price100");
        var listPrice = parseFloat("@Model.ListPrice");

        $('#txtQuantity').on('input change', function () {
            var qty = parseInt($(this).val());

            if (qty < 1 || isNaN(qty)) {
                qty = 1;
                $(this).val(1);
            }

            // Calculations
            var totalSalesPrice = (unitPrice * qty).toFixed(2);
            var totalListPrice = (listPrice * qty).toFixed(2);

            // Dono display elements ko update karna
            $('#totalPriceDisplay').text(totalSalesPrice);
            $('#totalListPriceDisplay').text(totalListPrice);

            console.log("Qty: " + qty + " | Sales: " + totalSalesPrice + " | List: " + totalListPrice);
        });
    });
</script>